# アセットパイプラインとは


アセットパイプラインとはJavaScriptやCSSファイルを一つのアセットとして読み込むための仕組みです。RailsでではフォルトでSproketというgemがインストールされており、このgemがアセットパイプラインとしての機能を担っています。

アセットパイプラインを使用することで複数のCSSファイルやJavaScriptファイルを読み込みたい場合でも通信回数を抑えることができるようになります。


# マニフェストファイル


マニフェストファイルはCSSやJavaScriptファイルを一纏めにするファイルです。このファイルでCSSやJavaScriptのファイルを一纏めにし、これをアセットパイプラインで読み込みます。

デフォルトでは 以下の二つのファイルがその役割を担っています。

```ruby
app/assets/stylesheets/application.scss
app/assets/javascripts/application.js
```


# アセット探索パス


アセットパイプラインではアセット探索パスに基づいてアセットを読み込んでくれます。

探索パスはデフォルトで

- app/assts/*
- lib/assets/*
- vender/assets/*

が設定されておりこの配下に存在するマニフェストファイルを読み込みます。

つまりRailsでCSSファイル、JavaScriptファイルを使用したい場合は

1. **読み込みたいCSS、JavaScriptファイルをマニフェストファイルに記述**
2. **アセット探索パス配下にマニフェストファイルを配置**

する必要があります。


### アセット探索パスの追加


アセット探索パスの配下に存在していないファイルは読み込まれないため上記のパス以外のCSSファイル、JavaScriptファイルを読み込みたい場合はアセット探索パスを追加してあげる必要があります。

例えばフロントエンドで使用するAdminLTEというライブラリを使用したい場合、このライブラリをインストールすると node_nodule というディレクトリが作成され、AdminLTEを使用するのに必要なCSSファイルやJavaScriptファイルが追加されます。

この node_module 配下のファイルはデフォルトではアセット探索パスの対象外になっているため config/initializers/assets.rb に次のようなパスを設定してあげる必要があります。

```ruby
# config/initializars/assets.rb

Rails.application.config.assets.paths << Rails.root.join("node_modules")
```

この記述を加えることでアセット探索パスが追加され、node_module配下のCSSファイル、JavaScriptファイルが読み込まれるようになります。


### マニフェストファイルの追加


管理画面用にadminディレクトリを作成し、通常のユーザー向けのものとは分けて読み込みたい場合などに config/initializers/assets.rb ファイルに以下の記述をすることでマニフェストファイルを追加することが出来ます。

```ruby
# config/initializars/assets.rb

Rails.application.config.assets.precompile += %w[admin.js admin.css] 
```

これによりデフォルトで設定してある

・app/assets/stylesheets/application.scss

・app/assets/javascripts/application.js

と管理者画面用の

・app/assets/stylesheets/admin.scss

・app/assets/javascripts/admin.js

がマニフェストファイルとしてアセットに読み込まれるようになります。


### ビューファイルへの読み込み


上記に記述した「アセット探索パスの設定」と「マニフェストファイルの設定」が出来ている場合、レイアウトファイルのheadタグ内に次のように記述することでCSSとJavaScriptを読み込むことが出来ます。

```html
<%= stylesheet_link_tag    'application', media: 'all' %>
<%= javascript_include_tag 'application' %>
```

上記の記述は app/assets/stylesheets/application.scss と app/assets/javascripts/application.js を読み込むための記述であり管理画面用のファイルを読み込みたい場合は

```html
<%= stylesheet_link_tag    'admin', media: 'all' %>
<%= javascript_include_tag 'admin' %>
```

のように記述します。こちらの記述では app/assets/stylesheets/admin.scss と app/assets/javascripts/admin.js が読み込まれます。


# 参考サイト


[アセットパイプライン - Railsガイド](https://railsguides.jp/asset_pipeline.html)

[[Ruby入門 Rails5編] 05. アセットパイプラインでフロントエンドのリソースを管理する - Qiita](https://qiita.com/prgseek/items/bf77c44189c55a7b41d8)

[[Rails] Webpacker gemとは](https://zenn.dev/yusuke_docha/articles/550eee06b1ab1e)

[Rails 6: Webpacker+Yarn+Sprocketsを十分理解してJavaScriptを書く: 後編（翻訳）｜TechRacho by BPS株式会社](https://techracho.bpsinc.jp/hachi8833/2021_06_10/85943)

[アセットパイプラインの仕組みについて - Qiita](https://qiita.com/junya__ya/items/6d768e9873eab9015e7d)
