# find_eachメソッドとは？

`find_each`メソッドとは大量のレコードをループ処理する際にメモリを抑えることができるメソッドです。

一度に１０００件のデータを取得して処理を行うため容量を抑えることができます。

そのため大きなデータを持つモデルを扱う場合などに使用されます。


# 基本構文

```ruby
モデル名.find_each do |変数|
  # 処理
end
```

上記のコードは次のステップで処理されます。

1. 対象のモデルからデータを１０００件取得する。
2. 取得した１０００件のデータを一つづつ処理する
3. １０００件の処理が終わったら、次の１０００件を取得して2の処理を行う
4. 全てのデータを確認するまでこれを繰り返す


# オプション

```ruby
モデル名.find_each(オプション: 値)
```

上記のように記述することでオプションを指定することができます。


## :batch_size

`:batch_size`はレコードの同時取得数を指定します。

```ruby
モデル名.find_each(batch_size: 同時取得数)
```

とすることでデフォルトでは１０００件である同時取得数を変更することができます。


## :start

`:start`はレコードの取得開始位置を指定します。

例えば以下のような記述をすると３０００以上のデータを対象に処理を行います。

```ruby
モデル名.find_each(start: スタート位置)
```

## :finish

`:finish`はレコードの取得終了位置を指定します。

以下のコードでは５０００でレコードの取得を終了しています。

```ruby
モデル名.find_each(finish: 終了位置)
```

## :order

`:order`オプションはレコードの順序を`:asc`、`:desc`という形で指定します。デフォルト値は`:asc`になっています。


# 参考サイト

[【Rails】 find_eachメソッドでメモリを節約して大量データを扱う方法 | Pikawaka](https://pikawaka.com/rails/find_each)

[find_each | Railsドキュメント](https://railsdoc.com/page/find_each)
